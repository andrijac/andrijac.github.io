
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Andrija's Blog</title>
  <meta name="author" content="Andrija Cacanovic">

  
  <meta name="description" content="I had a requirement to read multiple files in one go in Node.js project. Requirement: Read UTF8 files asynchronously.
Notify when each file read is &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://andrijac.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/style.css" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Andrija's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7816931-21']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Andrija's Blog</a></h1>
  
    <h2>Functional design</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:andrijac.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/link-farm/">Link Farm</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/08/read-multiple-files-in-node-dot-js/">Read multiple files in Node.js</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-08T05:09:00+00:00" pubdate data-updated="true">May 8<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had a requirement to read multiple files in one go in Node.js project.</p>

<p>Requirement:</p>

<ul>
<li>Read UTF8 files asynchronously.</li>
<li>Notify when each file read is done.</li>
<li>Notify when reading all files is done.</li>
</ul>


<p>I have found few examples on Stackoverflow:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/9618142/asynchronously-reading-and-caching-multiple-files-in-nodejs">Asynchronously reading and caching multiple files in nodejs</a></li>
<li><a href="http://stackoverflow.com/questions/9448336/reading-and-returning-multiple-files-in-node-js-using-fs-readfile">Reading and returning multiple files in Node.js using fs.readFile</a></li>
</ul>


<p>In both cases answer was to use either <a href="https://github.com/caolan/async"><code>async</code></a> library or to just use native node.js functions.</p>

<p>I don&rsquo;t like using external library and I am trying to use native/vanilla as much as possible. If there is one small part of external/third-party library that I have to use, I&rsquo;d rather write my own. For example, if I have to get reference to DOM element by <code>id</code> on web page, I&rsquo;d avoid using jQuery. If I would have to heavily traverse the DOM then I would definitely use jQuery.</p>

<p>So, I will skip using <code>async</code> library and use only native functions.</p>

<p>Here is complete code that we will go through:</p>

<p><em>Latest version of file is in repository on Github: <a href="https://github.com/andrijac/multiple-file-read/blob/master/MultipleFileRead/MultipleFileRead/multiread.js">multiread.js</a></em></p>

<figure class='code'><figcaption><span>multiread.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>   <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>      <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">),</span>
</span><span class='line'>          <span class="nx">readline</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;readline&#39;</span><span class="p">),</span>
</span><span class='line'>          <span class="nx">filePathList</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ii</span><span class="p">,</span>
</span><span class='line'>  
</span><span class='line'>          <span class="nx">toArray</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="p">},</span>
</span><span class='line'>  
</span><span class='line'>          <span class="nx">rl</span> <span class="o">=</span> <span class="nx">readline</span><span class="p">.</span><span class="nx">createInterface</span><span class="p">({</span>
</span><span class='line'>              <span class="nx">input</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">,</span>
</span><span class='line'>              <span class="nx">output</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>  
</span><span class='line'>      <span class="c1">// validate call, must contain at least 3 arguments</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">wl</span><span class="p">(</span><span class="s2">&quot;Usage: node multiread.js [file paths to read]&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>      <span class="c1">// start from 3rd argument, add them to filePathList</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">filePathList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">getActualFilePath</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>      <span class="c1">// check file path</span>
</span><span class='line'>      <span class="kd">function</span> <span class="nx">getActualFilePath</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">relative</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>          <span class="c1">// check absolute path</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">filePath</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="nx">filePath</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>          <span class="c1">// get absolute path from relative path</span>
</span><span class='line'>          <span class="nx">relative</span> <span class="o">=</span> <span class="p">[</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">filePath</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>          <span class="c1">// check relative path</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">relative</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="nx">relative</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;File &quot;</span> <span class="o">+</span> <span class="nx">filePath</span> <span class="o">+</span> <span class="s2">&quot; not found&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">      * @param execFunc {Function} Function that will be called for each argument set in @args array.</span>
</span><span class='line'><span class="cm">      * @param args {Object[]} Array where each item is array objects which will be used in each call.</span>
</span><span class='line'><span class="cm">      * @param eachCallback {Function} Callback after each execution.</span>
</span><span class='line'><span class="cm">      * @param callback {Function} Callback when all arguments are processed.</span>
</span><span class='line'><span class="cm">      */</span>
</span><span class='line'>      <span class="kd">function</span> <span class="nx">batch</span><span class="p">(</span><span class="nx">execFunc</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">eachCallback</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">iterate</span><span class="p">,</span> <span class="nx">results</span><span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>  
</span><span class='line'>          <span class="nx">cb</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">callResult</span> <span class="o">=</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
</span><span class='line'>                  <span class="nx">isLastItem</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">==</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>              <span class="c1">// put results from callback to results list for later processing</span>
</span><span class='line'>              <span class="c1">// results list is passed into final callback function</span>
</span><span class='line'>              <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callResult</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>              <span class="c1">// notify that current call is done</span>
</span><span class='line'>              <span class="nx">eachCallback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">callResult</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>              <span class="k">if</span><span class="p">(</span><span class="nx">isLastItem</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="c1">// if it is last item in args array, call final callback</span>
</span><span class='line'>                  <span class="nx">callback</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                  <span class="c1">// continue iteration through args</span>
</span><span class='line'>                  <span class="nx">iterate</span><span class="p">();</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">};</span>
</span><span class='line'>  
</span><span class='line'>          <span class="nx">iterate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">index</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">index</span><span class="p">,</span>
</span><span class='line'>                  <span class="nx">argsArray</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">||</span> <span class="p">[];</span>
</span><span class='line'>  
</span><span class='line'>              <span class="c1">// &#39;argsArray&#39; collection was created in &#39;batchRead&#39; method and it contains all arguments needed to invoke a function</span>
</span><span class='line'>              <span class="c1">// here we are adding last argument in collection which is callback function &#39;cb&#39; which is scoped inside parent function</span>
</span><span class='line'>              <span class="c1">// inside &#39;cb&#39; function iterate function will be called again until all arguments are not processed.</span>
</span><span class='line'>              <span class="nx">argsArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">cb</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">execFunc</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">argsArray</span><span class="p">);</span>
</span><span class='line'>          <span class="p">};</span>
</span><span class='line'>  
</span><span class='line'>          <span class="c1">// first iteration call</span>
</span><span class='line'>          <span class="nx">iterate</span><span class="p">();</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>  
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">      * @param files {string[]} File path list.</span>
</span><span class='line'><span class="cm">      * @param eachCallback {Function} Callback after each execution.</span>
</span><span class='line'><span class="cm">      * @param callback {Function} Callback when all arguments are processed.</span>
</span><span class='line'><span class="cm">      */</span>
</span><span class='line'>      <span class="kd">function</span> <span class="nx">batchRead</span><span class="p">(</span><span class="nx">files</span><span class="p">,</span> <span class="nx">eachCallback</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="nx">args</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>  
</span><span class='line'>          <span class="c1">// build args array</span>
</span><span class='line'>          <span class="nx">files</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">file</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">]);</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>  
</span><span class='line'>          <span class="nx">batch</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">eachCallback</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>      <span class="nx">batchRead</span><span class="p">(</span><span class="nx">filePathList</span><span class="p">,</span>
</span><span class='line'>          <span class="c1">// callback after each file read</span>
</span><span class='line'>          <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;File read done. Text: &quot;</span> <span class="o">+</span> <span class="nx">text</span><span class="p">);</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>  
</span><span class='line'>          <span class="c1">// callback when everything is done</span>
</span><span class='line'>          <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">insertTextArr</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>  
</span><span class='line'>              <span class="nx">result</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="nx">insertTextArr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>              <span class="p">});</span>
</span><span class='line'>  
</span><span class='line'>              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;All:&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">insertTextArr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">));</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>  
</span><span class='line'>      <span class="c1">// wait in console</span>
</span><span class='line'>      <span class="nx">rl</span><span class="p">.</span><span class="nx">question</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">rl</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span> <span class="p">});</span>
</span><span class='line'>  <span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<h2>TL;DR</h2>

<h3><code>batch</code> function</h3>

<p>The idea behind <code>batch</code> function was to have generic function that will execute array of asynchronous functions and wait for them to finish, something like what <code>async</code> doing, as long as signature of function is <code>function([parameters], callback)</code>.</p>

<p>Parameter description:</p>

<ol>
<li><code>execFunc</code> &ndash; function that is suppose to be executed for each argument set. In this case <code>execFunc</code> is <code>fs.readFile</code>.</li>
<li><code>args</code> &ndash; array of &lsquo;argument sets&rsquo; for each execution => &lsquo;argument set&rsquo; is array of arguments without callback. In this case, set contains file path and encoding.</li>
<li><code>eachCallback</code> &ndash; callback for each <code>execFunc</code> call.</li>
<li><code>callback</code> &ndash; callback when all is done.</li>
</ol>


<p>Inside <code>batch</code> function there are two functions: <code>cb</code> and <code>iterate</code>.</p>

<p><code>iterate</code> function does actual call to <code>execFunc</code>. It will add <code>cb</code> function to collection arguments at last position to act as actual callback of <code>execFunc</code>. This way we control each callback of <code>execFunc</code> and notify outside world when we want that it&rsquo;s all done. Also, this method will queue execution of asynchronous functions i.e. making them execute sequentially.</p>

<p><code>cb</code> function is a <code>execFunc</code> callback. As arguments of function are actual result of <code>execFunc</code> execution, this is the place where we will catch it.<br />
In <code>batch</code> function level, there is <code>results</code> array that will hold all results returned from <code>execFunc</code> executions. This array will be an argument for final callback call. <code>results</code> array is populated here on each call. <br />
Then, we will call <code>eachCallback</code> function to notify outside world that execution of <code>execFunc</code> is done.<br />
Then, we will check if this was a last <code>execFunc</code> call. If yes, call final <code>callback</code> sending all results as an argument. If no, continue iteration.</p>

<h3><code>batchRead</code> function</h3>

<p><code>batchRead</code> function wrapping a call to <code>batch</code> function to simplify call to generic <code>batch</code> function.</p>

<p>Parameter description:</p>

<ol>
<li><code>files</code> &ndash; array of file paths to be read.</li>
<li><code>eachCallback</code> &ndash; callback for each <code>fs.readFile</code> call.</li>
<li><code>callback</code> &ndash; callback when all is done.</li>
</ol>


<p>As <code>batch</code> function is accepting <code>object[object[]]</code> array for arguments, we need to repack file paths array to new array. Also, in each of these arrays, we will add additional argument => <code>utf8</code>. <br />
Then, we are calling <code>batch</code> function with all appropriate arguments.</p>

<h3><code>batchRead</code> call</h3>

<p>At the end, we will call <code>batchRead</code>. <code>eachCallback</code> should have same signature as you would use when calling <code>fs.readFile</code>.</p>

<h2>Summary</h2>

<p>If you have to call same function with different arguments several times, queue each call and have final callback, you can use <code>batch</code> function. <code>batchRead</code> shows how <code>batch</code> function can be utilized by reading multiple files sequentially and notifying the application when all is done.</p>

<p>HTH</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/31/javascript-breakpoint/">Javascript breakpoint</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-31T09:44:00+00:00" pubdate data-updated="true">Jan 31<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post will describe how to set breakpoint in before any javascript method call from console.</p>

<ul>
<li>GitHub repository: <a href="https://github.com/andrijac/break-js">https://github.com/andrijac/break-js</a></li>
<li>break.js: <a href="https://github.com/andrijac/break-js/blob/master/break.js">https://github.com/andrijac/break-js/blob/master/break.js</a></li>
<li>break.min.js: <a href="https://github.com/andrijac/break-js/blob/master/break.min.js">https://github.com/andrijac/break-js/blob/master/break.min.js</a></li>
</ul>


<p>In post:</p>

<ul>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#break">&ldquo;Break&rdquo; Function</a></li>
<li><a href="#usage">Usage</a></li>
</ul>


<h2>TL;DR</h2>

<h2>Background <a name="background" href="#background" class="anchor">#</a></h2>

<p>To make a long story short, I was working on a big single page web application a year ago, with huge javascript code base.
Whenever I wanted to set a breakpoint in editor/dev tools/firebug, it took time to find the function.
Either because it took time for source viewer to load (because of huge javascript files), or to locate in which file is function of interest.</p>

<p>So I have started inserting <code>debugger;</code> directive to my scripts when I need to break.
The problem was, then I wanted to remove the directive, I had find the directive, remove it or comment it out, and to reload the page, but as we were working on SPA, I basically had to restart my debugging sessions.
I also tried to make a global flag, and based on flag to set enable the debugger:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">IS_DEBUGGER_ENABLED</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">breakpoint</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">IS_DEBUGGER_ENABLED</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">debugger</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Whenever I wanted to turn debugger on, I could just set in console:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">IS_DEBUGGER_ENABLED</span> <span class="o">=</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Problem was I did not really like to have this function call all over the code.
Also, I wanted to have control where will code break, so I was then forced to go back and remove <code>breakpoint()</code> calls.</p>

<h2>Implementation <a name="implementation" href="#implementation" class="anchor">#</a></h2>

<p>The goal is to make a function that can insert a breakpoint before the call of any function we are interested in, which is accessible from global object.</p>

<p>Function needs to do following:</p>

<ul>
<li>Save reference to original function</li>
<li>Override original function with wrapper.</li>
<li>Option to restore original function and remove breakpoint.</li>
</ul>


<p>Let&rsquo;s say we have following object structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">.</span><span class="nx">func</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Path to <code>func</code> function is through <code>foo.bar.func</code>.
This is usually a case in huge javascript libraries such as Ext.js (Sencha), YUI etc.</p>

<p>To be able to set breakpoint, I would need to set <code>debugger;</code> right before <code>foo.bar.func</code> call.</p>

<p>So, I thought it would be nice to wrap <code>foo.bar.func</code> function in new function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">wrapper</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">debugger</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">.</span><span class="nx">func</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But wrapper also needs to be called <code>foo.bar.func</code>, because if function is called it has to actually call wrapper.
But if wrapper is set to <code>foo.bar.func</code>, it means it will override the original function, so we need save a reference to original function somewhere.</p>

<p>How to save a reference to a function? <br />
I could pass into wrapper a direct reference to function and assign it to variable, but instead I am passing in a function name. The reason for this is because I need to access a function dynamically and also I will need a key to reference back to original function.
You will see what I mean as I go further in post. I might change this in the future and be able to pass direct reference to function in wrapper.
Ok, as I have only function name, only way I found (at the moment) to call a function was by compiling a new Function object that calls a function.
You could easily call a global function by name through <code>window</code> object (in browser):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">window</span><span class="p">[</span><span class="s1">&#39;function_name&#39;</span><span class="p">](</span><span class="nx">parameters</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This works if function is on global object, but if function in inside another object, this will not work.
So, to invoke <code>foo.bar.func</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">func_name</span> <span class="o">=</span> <span class="s1">&#39;foo.bar.func&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Compile a new Function that is returning a reference to function and execute it.</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">func_reference</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;return &quot;</span> <span class="o">+</span> <span class="nx">func_name</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="p">))();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have original function reference assigned to variable and we can override function with wrapper.
Wrapper should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">wrapper</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Convert arguments to array</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Break before original function call</span>
</span><span class='line'>  <span class="kr">debugger</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Call a function.</span>
</span><span class='line'>  <span class="c1">// &#39;this&#39; should be the same as it would be in original function since wrapper replaced original function.</span>
</span><span class='line'>  <span class="c1">// We will always return result from original function.</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">original_function</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Override function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">override</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;overrideFunc&quot;</span><span class="p">,</span> <span class="nx">funcName</span> <span class="o">+</span> <span class="s2">&quot; = overrideFunc;&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>&ldquo;Break&rdquo; function <a name="break" href="#break" class="anchor">#</a></h2>

<p>Finally, &ldquo;break&rdquo; function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">__break</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// as we need to keep original functions, we will use clousers to keep a original functions here.</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{},</span>
</span><span class='line'>      <span class="nx">cArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span> <span class="p">},</span>
</span><span class='line'>      <span class="nx">concat</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">cArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// funcName - name of the function, full name accessable from global object.</span>
</span><span class='line'>  <span class="c1">// removeBreakpoint - use it only when you want to remove a breakpoint, set it to any truthful value.</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">funcName</span><span class="p">,</span> <span class="nx">removeBreakpoint</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// get reference to original function</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">original</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="nx">concat</span><span class="p">(</span><span class="s2">&quot;return &quot;</span><span class="p">,</span> <span class="nx">funcName</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">)))(),</span>
</span><span class='line'>          <span class="c1">// compile override function</span>
</span><span class='line'>          <span class="nx">override</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;overrideFunc&quot;</span><span class="p">,</span> <span class="nx">concat</span><span class="p">(</span><span class="nx">funcName</span> <span class="p">,</span> <span class="s2">&quot; = overrideFunc;&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// check removeBreakpoint flag if it is true.</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="o">!!</span><span class="nx">removeBreakpoint</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// restore original function</span>
</span><span class='line'>          <span class="nx">override</span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]);</span>
</span><span class='line'>          <span class="c1">// remove from cached collection</span>
</span><span class='line'>          <span class="k">delete</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">funcName</span><span class="p">];</span>
</span><span class='line'>          <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// if function is already overriden, exit</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="o">!!</span><span class="nx">cache</span><span class="p">[</span><span class="nx">funcName</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// cache original function</span>
</span><span class='line'>      <span class="nx">cache</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">original</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// override original function</span>
</span><span class='line'>      <span class="nx">override</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">cArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>          <span class="kr">debugger</span><span class="p">;</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}());</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Usage <a name="usage" href="#usage" class="anchor">#</a></h2>

<p>To set the breakpoint:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">__break</span><span class="p">(</span><span class="s1">&#39;foo.bar.func&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>To remove the breakpoint:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">__break</span><span class="p">(</span><span class="s1">&#39;foo.bar.func&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Potentially, we could add this function to <code>console</code> object:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">console</span><span class="p">.</span><span class="k">break</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="k">break</span> <span class="o">=</span> <span class="nx">__break</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Repository is at: <a href="https://github.com/andrijac/break-js">https://github.com/andrijac/break-js</a></p>

<p>HTH</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/21/octopress-publishing-environment-in-the-cloud/">Octopress publishing environment in the cloud</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-21T10:29:00+00:00" pubdate data-updated="true">Dec 21<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was looking for a blog platform:</p>

<ul>
<li>Good support for developers (sharing code snippets and github gists).</li>
<li>Highly customizable layout &ndash; I don&rsquo;t have to depend on decision of some third party whether they will add a feature that I need</li>
<li>Ability to back up blog content.</li>
<li>Independency of hosting platform.</li>
<li>Ability to recreate a blog anywhere anytime.</li>
<li>Keeping a track of changes.</li>
</ul>


<h2>Octopress<a name="octopress" href="#octopress" class="anchor">#</a></h2>

<p>It sounds too good to be true, but the thing is you can find all these features in <a href="http://octopress.org/">Octopress</a>.</p>

<p><em><a href="http://octopress.org/">octopress.org</a></em> :</p>

<blockquote><p>Octopress is a framework designed by <a href="http://brandonmathis.com/">Brandon Mathis</a> for <a href="http://github.com/mojombo/jekyll">Jekyll</a>, the blog aware static site generator powering Github Pages</p></blockquote>

<p>Some features of Octopress mentioned here also apply to Jekyll.</p>

<h4><em>Good support for developers</em></h4>

<p>In Octopress, there is <a href="http://octopress.org/docs/">great support</a> for embedding code in your blog.</p>

<h4><em>Highly customizable layout</em></h4>

<p>You can customize anything on the blog. Big advantage is that there is no admin user interface that will interfere of changing anything on blog. Some people would consider this as a disadvantage, but I think that to have highly generic interface with ability to change anything in website is very hard to make and to maintain.
If you want to add a feature, it would require you to have user interface to support it, which also mean additional user interface to maintain along with this feature. By not having any user interface and counting on user to change the blog manually, the possibilities are endless.<br />
Of course this assumes that you know what you are doing which means that Octopress is not for anyone. <br />
Read more on this topic in <a href="http://www.cooper.com/journal/2012/08/the-best-interface-is-no-interface">The best interface is no interface</a>.</p>

<h4><em>Ability to back up blog content</em></h4>

<p>You are writing Octopress articles in plain text Markdown so there is no database to be backed up, there is no special data store to extract data from, and you just back up the files. Ever since Markdown became popular through Stackoverflow.com and Github, it is becoming more and more accepted in developer community as a common formatting syntax for documentation.</p>

<h4><em>Independency of hosting platform</em></h4>

<p>Final output of Octopress is static html-css-javascript, which means it can be hosted anywhere.</p>

<h4><em>Ability to recreate a blog anywhere anytime</em></h4>

<p>You are not depended on proprietary software or some closed platform to recreate the output of your blog, you can do that anytime you want.</p>

<h4><em>Keeping a track of changes</em></h4>

<p>To start using Octopress, you need to fork it on Github, which means you will immediately have Git repository for Octopress. Anything you change or publish can be committed in Git. Is there any better way to track changes in blog? I do not think so.</p>

<h2>Nitrous.IO<a name="nitrous" href="#nitrous" class="anchor">#</a></h2>

<p>I found about <a href="https://www.nitrous.io/join/OqTrHcEDHjk">Nitrous.IO</a> on Joe Marini&rsquo;s post <a href="http://joemarini.blogspot.ae/2013/11/tools-for-developing-on-chromeos.html">Tools for Developing on ChromeOS</a>.
It seemed very interesting because it was a remote view on VM in browser, rendered in HTML. And as we know once rendered in HTML it can be displayed and worked with anywhere, no plugins or third-party software required.
I gave it a try and created Ruby box. What I got is Linux VM running:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lsb_release -a
</span><span class='line'># Ubuntu 12.04.3 LTS.</span></code></pre></td></tr></table></div></figure>


<p>Once I have setup the box, I went on to <a href="https://www.nitrous.io/app#/n2o/bonus">bonus page</a> and connected all of my online identities to Nitrous.IO to get additional N2O (N2O is like are Nitrous.IO currency for upgrading your box).</p>

<h2>Octopress + Nitrous.IO<a name="OctopressNitrous" href="#OctopressNitrous" class="anchor">#</a></h2>

<p>I am switching workstations and environments a lot. On the other hand, Octopress requires some stuff to be preinstalled in your local environment. I also switch OSs so having to setup environment on Windows all the time can be time consuming.
I figured I could have an always Octopress ready environment on Nitrous.IO. This is only way to have Octopress always available. The trend how cloud computing is progressing, I think that personal workstation on remote VM <a href="http://yieldthought.com/post/12239282034/swapped-my-macbook-for-an-ipad">will be more and more practice</a>.</p>

<h2>Setting up<a name="setup" href="#setup" class="anchor">#</a></h2>

<h4>In summary</h4>

<p>These are the steps that we will need to go through to setup a blog:</p>

<ul>
<li>Register on Github</li>
<li>Register on Nitrous.IO</li>
<li>Change a Ruby version</li>
<li>Clone and setup Octopress</li>
</ul>


<p>I have chosen to host the blog on Github, which means that address will be [username].github.io.</p>

<p>I am hosting this blog on Github and I will describe here how to host it there. You do have <a href="http://octopress.org/docs/deploying/">other options available</a>, and since blog is generated in plain html-css-javascript, it can be hosted anywhere.</p>

<p>Register on <a href="https://www.nitrous.io/join/OqTrHcEDHjk">Nitrous.IO</a> and create a Ruby box. I am still not sure what are the differences between other boxes, for example I have node.js installed on Ruby box so I&rsquo;m not sure what is special about node.js box.</p>

<p>Box will be created in a few seconds and ready to roll. You will see <code>workspace</code> folder in folder tree on a side.</p>

<p>Further, I have used <a href="http://octopress.org/docs/setup/">Octopress setup</a>.</p>

<p>Git should be already installed, but you can check:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git --version
</span><span class='line'># git version 1.8.4.3</span></code></pre></td></tr></table></div></figure>


<p>Check Ruby version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ruby --version
</span><span class='line'># ruby 2.0.0p247 (2013-06-27 revision 41674) [x86_64-linux]</span></code></pre></td></tr></table></div></figure>


<p><a name="rbenv"></a>
Ruby version required for Octopress is 1.9.3. So, we need to change a Ruby version. I used <code>rbenv</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/sstephenson/rbenv.git ~/.rbenv
</span><span class='line'>echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bashrc
</span><span class='line'>echo 'eval "$(rbenv init -)"' >> ~/.bashrc
</span><span class='line'>git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
</span><span class='line'>source ~/.bashrc</span></code></pre></td></tr></table></div></figure>


<p>At this point, you might need to restart a console. Opening new console should do it.
Install Ruby 1.9.3:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rbenv install 1.9.3-p0</span></code></pre></td></tr></table></div></figure>


<p>Clone Octopress from Github. I created a folder inside workspace folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/imathis/octopress.git ~/workspace/octopress
</span><span class='line'>cd ~/workspace/octopress</span></code></pre></td></tr></table></div></figure>


<p>Setup use of Ruby 1.9.3 in local folder (your path should be now ~/workspace/octopress):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rbenv local 1.9.3-p0
</span><span class='line'>rbenv rehash</span></code></pre></td></tr></table></div></figure>


<p>Install dependencies:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install bundler
</span><span class='line'>rbenv rehash
</span><span class='line'>bundle install</span></code></pre></td></tr></table></div></figure>


<p>Install default Octopress theme:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake install</span></code></pre></td></tr></table></div></figure>


<h3>Deploying to Github Pages <a name="githubdeploy" href="#githubdeploy" class="anchor">#</a></h3>

<p>As I said before, if you are planning to deploy to Github pages, your address will be <code>http://username.github.io</code>.
You need to create a repository which will be called <code>username.github.io</code>.
<a href="http://octopress.org/docs/deploying/github/">Here are detail instructions</a>, but here I will give summary of all the steps you need to do.</p>

<p>Run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake setup_github_pages</span></code></pre></td></tr></table></div></figure>


<p>It will ask you for repository url, which it supposed to be <code>https://github.com/username/username.github.io.git</code>.
Github recommends HTTPS over SSH, <a href="http://stackoverflow.com/a/11041782/84852">why?</a></p>

<p>Make sure are have Github email and username configured:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global user.email "your email"
</span><span class='line'>git config --global user.name "username"</span></code></pre></td></tr></table></div></figure>


<p><a name="commit"></a>Next, push the current source to <code>source</code> branch:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add .
</span><span class='line'>git commit -m "commit message"
</span><span class='line'>git push origin source</span></code></pre></td></tr></table></div></figure>


<p><a name="deploy"></a>Next, generate and deploy.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate
</span><span class='line'>rake deploy</span></code></pre></td></tr></table></div></figure>


<p>To clarify, you will have 2 branches in repository:</p>

<ul>
<li><code>source</code> branch holding the source of the blog, which you are using for generation.</li>
<li><code>master</code> branch which will be static generated content. Github pages are configured so anything that appears in repository called <code>username.github.io</code> in <code>master</code> branch will appear on your Github page.</li>
</ul>


<p><code>rake generate</code> will generate static content locally in <code>_deploy/</code> folder.
<code>rake deploy</code> will push the changes to <code>master</code> branch.</p>

<p>At this point, you are done. It will take few minutes for Github to publish the page for the first time, later on it will be pushed much quicker.</p>

<h2>Blogging<a name="blogging" href="#blogging" class="anchor">#</a></h2>

<p>Helpful links:</p>

<ul>
<li><a href="http://octopress.org/docs/configuring/">Cofiguration</a></li>
<li><a href="http://octopress.org/docs/blogging/">Blogging Basics</a></li>
</ul>


<p>Some quick notes:</p>

<ul>
<li>Configuration file is <code>_config.yml</code>. You can configure all global settings there like title, description, add Github account, Disqus account etc.</li>
<li>Create a new post: <code>rake new_post["post title"]</code> this will create a new markdown document in <code>source/_posts</code>.</li>
<li>Preview the blog:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate   # Generates posts and pages into the public directory
</span><span class='line'>rake watch      # Watches source/ and sass/ for changes and regenerates
</span><span class='line'>rake preview    # Watches, and mounts a webserver at http://localhost:4000</span></code></pre></td></tr></table></div></figure>


<p>You will be able to see your blog on port 4000. In Nitrous.IO, go to menu <code>Preview &gt; Port 4000</code> and it will open a blog preview in new tab</p>

<ul>
<li>To commit changes to Git, use the same <a href="#commit">git commands</a> like in initial commit.</li>
<li>Once you are ready to publish, use the same <a href="#deploy">rake commands</a> for publish like you did initially.</li>
</ul>


<p>HTH</p>

<p><strong>Edit</strong> 2013-01-03:</p>

<p>It has come to my attention that <code>rvm</code> is already installed on VM, which is also used to <a href="#rbenv">change ruby version in environment</a>. By using <code>rvm</code>, you can preserve disk space on VM.
<a href="http://octopress.org/docs/setup/rvm/">Documentation for using <code>rvm</code></a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/02/backup-existing-project-to-cloud-source-control/">Backup existing project to cloud source control</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-02T07:12:00+00:00" pubdate data-updated="true">Dec 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This artical explains how to backup your existing Visual Studio project to Bitbucket using Mercurial. This may as well apply to any other type of project out there, but I might use some Visual Studio specifics in article.</p>

<p>All you need for this is to download <a href="http://mercurial.selenic.com/">Mercurial</a>.</p>

<h2>Create repository<a name="create" href="#create" class="anchor">#</a></h2>

<p>I use Bitbucket because it has free private repositories. It supports both Mercurial and Git.
I prefer to use Mercurial on Bitbucket because I have used it from the beginning and find it more intuitive to use.
There is great tutorial on how to use Mercurial by Joel Spolsky on <a href="http://hginit.com">hginit.com</a>. I highly recommend starting there.</p>

<p>First, you need to create repository in Bitbucket. When giving a name to repository, try not to use white space because you might have trouble later on when you use command line. Make sure Mercurial is selected as a &ldquo;Repository type&rdquo;.
Also, make sure &ldquo;Access level: This is a private repository&rdquo; is checked. You could create public repository, but I assume you will be backing up the code that you don&rsquo;t want public to see.</p>

<h2>Clone repository<a name="clone" href="#clone" class="anchor">#</a></h2>

<p>Let&rsquo;s say you have folder structure like this:</p>

<pre><code>~/
  |_MyProject
    |_DevelopBranch     
</code></pre>

<p>You want to backup all code from <code>DevelopBranch</code>.</p>

<p>Go to command prompt and locate <code>cd ~/MyProject</code></p>

<p>Execute <code>hg clone https://username@bitbucket.org/username/repository-name</code> to create local repository.<br />
This command will create local folder with repository.
Note to replace <code>username</code> with your username on Bitbucket and <code>repository-name</code> with your repository name.
When I did this, my repository name was MyProject-Develop and I did not want my folder to be named like this, but I wanted it to remain <code>DevelopBranch</code>. You can keep your folder name by adding folder name at the end of command:
<code>hg clone https://username@bitbucket.org/username/repository-name foldter-name</code>. You can create as many respositories as you want, so if you make a mistake, just delete the folder and try again.</p>

<p>If you try to create repository in same folder where your code is already you will notice that cloning will not execute but it will say that folder is not empty.
Workaround for this is to make a rename existing folder tempraraly, execute clone command, move <code>.hg</code> folder to original folder, delete clone folder and rename back the original folder :)
So, I renamed the folder to <code>DevelopBranch2</code> and executed clone command. Now, command was successful and I had new folder <code>DevelopBranch</code> which contains only one folder inside <code>.hg</code>. I copied the <code>.hg</code> folder to <code>DevelopBranch2</code>, deleted <code>DevelopBranch</code> and renamed <code>DevelopBranch2</code> back to <code>DevelopBranch</code>. Simple, right? :)</p>

<h2>Add files to repository<a name="add" href="#add" class="anchor">#</a></h2>

<p>Create <code>.hgignore</code> file from <a href="https://gist.github.com/andrijac/4027502">https://gist.github.com/andrijac/4027502</a> and place it in <code>DevelopBranch</code> folder. This will exclude files from eyes of source control that usually are compiled or outputted by build process, very similar like how TFS is ignoring specific files from your source folder (like .dll, .exe, /obj etc.).</p>

<p>In command line, go to <code>cd ~/MyProject/DevelopBranch</code>. All further commands will be executed from this path.</p>

<p>Run the command <code>hg status</code> in your DevelopBranch to see what has Mercurial detected for adding into source control. If the list is too big (it usually is when adding big project), use <code>hg status &gt; output.txt &amp;&amp; output.txt</code> to see all the files added. You will see that files have <code>?</code> status on the left side of file path indicating that files are detected in target folder but are not part of repository yet.</p>

<p>Execute <code>hg add</code> to add all the files to repository.</p>

<p>Now when you run <code>hg status</code> you should get <code>A</code> status on the left side of file name indicating that files is added.</p>

<p>Next, commit the changes in repository: <br />
<code>hg commit -m "initial commit" -u username</code></p>

<p>Next, execute <code>hg push</code> which will push (upload) repository changes to Bitbucket repository.
You will be asked to enter password for authentication.
It might take some time to upload all the changes depending on your project size.</p>

<h2>Maintaining the future changes<a name="maintain" href="#maintain" class="anchor">#</a></h2>

<p>And you are done. Next time you want to upload new changes in project:</p>

<pre><code>hg status
hg addremove
hg commit -m "commit 2013-12-01" -u username
hg push
</code></pre>

<p>HTH</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/08/read-multiple-files-in-node-dot-js/">Read multiple files in Node.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/31/javascript-breakpoint/">Javascript breakpoint</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/21/octopress-publishing-environment-in-the-cloud/">Octopress publishing environment in the cloud</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/02/backup-existing-project-to-cloud-source-control/">Backup existing project to cloud source control</a>
      </li>
    
  </ul>
</section>

<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/109273118141702333884?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Andrija Cacanovic -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
